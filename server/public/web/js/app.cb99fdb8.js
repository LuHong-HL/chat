(function(e){function t(t){for(var a,o,i=t[0],c=t[1],l=t[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&f.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],a=!0,i=1;i<s.length;i++){var c=s[i];0!==n[c]&&(a=!1)}a&&(r.splice(t--,1),e=o(o.s=s[0]))}return e}var a={},n={app:0},r=[];function o(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=a,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(s,a,function(t){return e[t]}.bind(null,a));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=c;r.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"107b":function(e,t,s){},"138d":function(e,t,s){"use strict";var a=s("966a"),n=s.n(a);n.a},2418:function(e,t,s){"use strict";var a=s("f8fa"),n=s.n(a);n.a},"2a56":function(e,t,s){"use strict";var a=s("3608"),n=s.n(a);n.a},"2bb9":function(e,t,s){"use strict";var a=s("7911"),n=s.n(a);n.a},"34bc":function(e,t,s){"use strict";var a=s("41b7"),n=s.n(a);n.a},3608:function(e,t,s){},3738:function(e,t,s){"use strict";var a=s("ebba"),n=s.n(a);n.a},"41b7":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},r=[],o=s("2877"),i={},c=Object(o["a"])(i,n,r,!1,null,null,null),l=c.exports,u=(s("b64b"),s("8c4f")),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("router-view"),s("van-tabbar",{attrs:{"active-color":"#08c161","inactive-color":"#000"},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[s("van-tabbar-item",{attrs:{replace:"",to:"/main/home",name:"/main/home"},scopedSlots:e._u([{key:"icon",fn:function(e){return s("span",{class:e.active?"iconfont iconchat":"iconfont iconchat_bubble"})}}])},[s("span",[e._v("通信")])]),s("van-tabbar-item",{attrs:{replace:"",to:"/main/address_book",name:"/main/address_book"},scopedSlots:e._u([{key:"icon",fn:function(e){return s("span",{class:e.active?"iconfont iconaddressbook_fill":"iconfont iconaddressbook",attrs:{size:"50px"}})}}])},[s("span",[e._v("通讯录")])]),s("van-tabbar-item",{attrs:{replace:"",to:"/main/find",name:"/main/find"},scopedSlots:e._u([{key:"icon",fn:function(e){return s("span",{class:e.active?"iconfont iconfaxian1":"iconfont iconfaxian"})}}])},[s("span",[e._v("发现")])]),s("van-tabbar-item",{attrs:{replace:"",to:"/main/my",name:"/main/my"},scopedSlots:e._u([{key:"icon",fn:function(e){return s("span",{class:e.active?"iconfont iconiconfontzhizuobiaozhun04":"iconfont iconiconfontzhizuobiaozhun08"})}}])},[s("span",[e._v("我")])])],1)],1)},f=[],p={data:function(){return{active:this.$route.path}},computed:{}},m=p,v=(s("2bb9"),Object(o["a"])(m,d,f,!1,null,"a7db4120",null)),h=v.exports,g=(s("96cf"),s("1da1")),x=s("2f62");a["a"].use(x["a"]);var y={user:{},chatMessage:{},worldMessage:[]},_={updateUser:function(e,t){console.log("storeUser",t),e.user=t,sessionStorage.user=JSON.stringify(e.user)},updateUsername:function(e,t){e.user.username=t;var s=JSON.parse(sessionStorage.user);s.username=t,sessionStorage.user=JSON.stringify(s)},updateAvatar:function(e,t){e.user.avatar=t;var s=JSON.parse(sessionStorage.user);s.avatar=t,sessionStorage.user=JSON.stringify(s)},privateChat:function(e,t){console.log("chatMessage",t),void 0===e.chatMessage[t.fromId]&&a["a"].prototype.$set(e.chatMessage,t.fromId,[]),e.chatMessage[t.fromId].push(t),console.log("chatMessage2",e.chatMessage)},privateChatSelf:function(e,t){void 0===e.chatMessage[t.toId]&&a["a"].prototype.$set(e.chatMessage,t.toId,[]),e.chatMessage[t.toId].push(t)},updateWorldMessageSendBySelf:function(e,t){e.worldMessage.push(t)}},b={},w={SOCKET_connect:function(e){var t=e.state;return Object(g["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("socketId",a["a"].prototype.$socket.id),s={},s.userId=t.user._id,s.socketId=a["a"].prototype.$socket.id,e.next=6,a["a"].prototype.$http.put("/rest/sockets",s);case 6:case"end":return e.stop()}}),e)})))()},SOCKET_addFriend:function(){a["a"].prototype.$notify({type:"success",message:"有新好友请求"})},SOCKET_privateChat:function(e,t){var s=e.commit;s("privateChat",t)},SOCKET_worldMessage:function(e,t){var s=e.commit;console.log("res...",t),s("updateWorldMessageSendBySelf",t)},SOCKET_updateFriends:function(e){var t=e.dispatch;a["a"].prototype.$notify({type:"success",message:"有新朋友添加成功"}),t("updateUser")},updateChatMessage:function(e,t){var s=e.commit;s("privateChat",t)},updateUser:function(e){var t=e.commit,s=e.state;return Object(g["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("storeActionsUser"),e.next=3,a["a"].prototype.$http.get("/rest/users/detail/".concat(s.user._id));case 3:n=e.sent,t("updateUser",n.data);case 5:case"end":return e.stop()}}),e)})))()},disconnectSocket:function(e){var t=e.state;t.user={},a["a"].prototype.$socket.disconnect()}},k=new x["a"].Store({state:y,mutations:_,actions:w,getters:b}),C=k,$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"home"},[s("my-top-bar",{attrs:{"left-text":"通信"},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",{staticClass:"nav-bar_right"},[s("span",{staticClass:"va-middle iconfont iconsousuo pr-3 fs-xxl"}),s("span",{staticClass:"va-middle iconfont icontianjia fs-xl"})])]},proxy:!0}])}),s("div",{staticClass:"container"},e._l(15,(function(t,a){return s("van-cell",{key:a,staticClass:"cell-container d-flex ai-center fs-lg",scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-image",{attrs:{width:"1.1112rem",height:"1.1112rem",radius:".133333rem",src:"https://img.yzcdn.cn/vant/cat.jpeg"}})]},proxy:!0},{key:"title",fn:function(){return[s("div",{staticClass:"d-flex"},[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark flex-grow-1"},[e._v("我是小小明鸭")]),s("span",{staticClass:"cell-title pl-1 fs-sm text-dark-3"},[e._v("12:35")])])]},proxy:!0},{key:"label",fn:function(){return[s("span",{staticClass:"cell-title fs-sm pl-1 text-dark-3"},[e._v(e._s(t)+"有东西聊吗")])]},proxy:!0}],null,!0)})})),1)],1)},S=[],j={data:function(){return{}},created:function(){}},O=j,M=(s("b7d3"),Object(o["a"])(O,$,S,!1,null,"c45c68f8",null)),I=M.exports,T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"address-book-container"},[s("my-top-bar",{attrs:{"left-text":"通讯录"},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",{staticClass:"nav-bar_right"},[s("span",{staticClass:"va-middle iconfont iconsousuo pr-3 fs-xxl"}),s("span",{staticClass:"va-middle iconfont icontianjia fs-xl"})])]},proxy:!0}])}),s("van-index-bar",{staticClass:"index-class",attrs:{"index-list":e.indexList}},[s("van-cell-group",{staticClass:"functional-area"},[s("van-cell",{staticClass:"d-flex ai-center",attrs:{to:"/new_friends"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("div",{staticClass:"my-icon my-icon-1 d-flex jc-center ai-center"},[s("van-icon",{attrs:{"class-prefix":"iconfont iconbg-add-friend",size:".586667rem",color:"#fff"}})],1)]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark"},[e._v("新的朋友")])]},proxy:!0}])}),s("van-cell",{staticClass:"d-flex ai-center",scopedSlots:e._u([{key:"icon",fn:function(){return[s("div",{staticClass:"my-icon my-icon-2 d-flex jc-center ai-center"},[s("van-icon",{attrs:{"class-prefix":"iconfont iconqunliao",size:".586667rem",color:"#fff"}})],1)]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark"},[e._v("群聊")])]},proxy:!0}])}),s("van-cell",{staticClass:"d-flex ai-center",scopedSlots:e._u([{key:"icon",fn:function(){return[s("div",{staticClass:"my-icon my-icon-3 d-flex jc-center ai-center"},[s("van-icon",{attrs:{"class-prefix":"iconfont iconbiaoqian",size:".586667rem",color:"#fff"}})],1)]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark"},[e._v("标签")])]},proxy:!0}])})],1),e._l(e.indexList,(function(e,t){return s("div",{key:t})})),e._l(e.friendsList,(function(t,a){return s("van-cell",{key:a,staticClass:"d-flex ai-center",on:{click:function(s){return e.goToFriendPage(t)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-image",{attrs:{width:"1rem",height:"1rem",radius:".133333rem",src:t.avatar}})]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark"},[e._v(e._s(t.username))])]},proxy:!0}],null,!0)})}))],2)],1)},P=[],E={created:function(){},data:function(){return{indexList:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]}},methods:{goToFriendPage:function(e){this.$router.push({path:"/address_book/friend",query:e})}},computed:{friendsList:function(){return this.$store.state.user.friends}}},R=E,z=(s("34bc"),Object(o["a"])(R,T,P,!1,null,"2135ab3e",null)),F=z.exports,A=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("my-top-bar",{attrs:{"left-text":"发现"},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",{staticClass:"nav-bar_right"},[s("span",{staticClass:"va-middle iconfont iconsousuo pr-3 fs-xxl"}),s("span",{staticClass:"va-middle iconfont icontianjia fs-xl"})])]},proxy:!0}])}),s("div",{staticClass:"find-container"},[s("van-cell-group",[s("van-cell",{staticClass:"d-flex ai-center jc-between fs-lg pt-1-5 pb-1-5",scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-icon",{attrs:{"class-prefix":"iconfont iconpengyouquan",size:".586667rem",color:"#2e92f0"}})]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark flex-grow-1"},[e._v("朋友圈")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell-group",{staticClass:"mt-1"},[s("van-cell",{staticClass:"d-flex ai-center jc-between fs-lg pt-1-5 pb-1-5",attrs:{to:"/main/find/world"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-icon",{attrs:{"class-prefix":"iconfont iconWorld",size:".586667rem",color:"#08c161"}})]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark flex-grow-1"},[e._v("世界喊话")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1)],1)],1)},U=[],q={data:function(){return{}}},N=q,B=Object(o["a"])(N,A,U,!1,null,"7786f466",null),D=B.exports,J=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("van-cell-group",{staticClass:"my-header pb-2 pt-2"},[s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg mt-1 mb-1",attrs:{to:"/user"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-image",{attrs:{width:"1.555555rem",height:"1.555555rem",radius:".133333rem",src:e.$store.state.user.avatar,fit:"cover"}})]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-xxl text-dark flex-grow-1"},[e._v(e._s(e.$store.state.user.username))])]},proxy:!0},{key:"label",fn:function(){return[s("div",{staticClass:"d-flex"},[s("span",{staticClass:"cell-title fs-md pl-1 text-dark-3 flex-grow-1"},[e._v("通信号:"+e._s(e.$store.state.user.phone))]),s("div",{staticClass:"d-flex"},[s("div",{staticClass:"pr-1"},[s("van-icon",{attrs:{"class-prefix":"iconfont iconerweima",size:".373333rem",color:"#e8e8e8"}})],1),s("van-icon",{attrs:{"class-prefix":"iconfont iconarrow-right-copy-copy-copy",size:".5rem",color:"#e8e8e8"}})],1)])]},proxy:!0}])})],1),s("van-cell-group",{staticClass:"my-container"},[s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg pt-1-5 pb-1-5",attrs:{to:"/set_up"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-icon",{attrs:{"class-prefix":"iconfont iconshezhi",size:".586667rem",color:"#2e92f0"}})]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark flex-grow-1"},[e._v("设置")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1)],1)},W=[],L={data:function(){return{message:"",socket:""}}},K=L,Y=(s("dc12"),Object(o["a"])(K,J,W,!1,null,"4323b1e6",null)),H=Y.exports,V=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login-container d-flex jc-center ai-center"},[s("div",{staticClass:"login-inner-container p-3"},[s("div",{staticClass:"login-image"}),s("van-tabs",{attrs:{border:!1},model:{value:e.model.active,callback:function(t){e.$set(e.model,"active",t)},expression:"model.active"}},[s("van-tab",{attrs:{title:"登录"}},[s("van-form",{on:{submit:e.login}},[s("div",{staticClass:"field"},[s("van-field",{attrs:{rules:[{validator:e.validatorPhone,message:"请输入正确手机号"}],label:"手机号",placeholder:"请输入手机号"},model:{value:e.model.login.phone,callback:function(t){e.$set(e.model.login,"phone",t)},expression:"model.login.phone"}}),s("van-field",{attrs:{type:"password",rules:[{required:!0,message:"密码不能为空"}],label:"密码",placeholder:"请输入密码"},model:{value:e.model.login.password,callback:function(t){e.$set(e.model.login,"password",t)},expression:"model.login.password"}})],1),s("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("登录")]),s("p",{staticClass:"fs-md text-dark"},[e._v("短信验证登录")])],1)],1),s("van-tab",{attrs:{title:"注册"}},[s("van-form",{on:{submit:e.register}},[s("div",{staticClass:"field"},[s("van-field",{attrs:{rules:[{validator:e.validatorUsername,message:"请输入1-8位字符的用户名"}],placeholder:"请输入用户名",label:"用户名"},model:{value:e.model.register.username,callback:function(t){e.$set(e.model.register,"username",t)},expression:"model.register.username"}}),s("van-field",{attrs:{placeholder:"请输入手机号",label:"手机号",rules:[{validator:e.validatorPhone,message:"请输入正确手机号"}]},model:{value:e.model.register.phone,callback:function(t){e.$set(e.model.register,"phone",t)},expression:"model.register.phone"}}),s("van-field",{attrs:{type:"password",placeholder:"请输入密码",label:"密码",rules:[{validator:e.validatorPassword,message:"请输入3位以上的密码"}]},model:{value:e.model.register.password,callback:function(t){e.$set(e.model.register,"password",t)},expression:"model.register.password"}}),s("van-field",{attrs:{type:"password",placeholder:"再次输入密码",label:"确认密码",rules:[{validator:e.validatorPassword2,message:"两次密码输入不一致"}]},model:{value:e.model.register.password2,callback:function(t){e.$set(e.model.register,"password2",t)},expression:"model.register.password2"}})],1),s("van-button",{attrs:{round:"",block:"",type:"info","native-type":"submit"}},[e._v("注册")])],1)],1)],1)],1)])},G=[],Q={data:function(){return{model:{active:0,register:{username:"",phone:"",password:"",password2:""},login:{username:"",password:""}}}},methods:{login:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("/login",e.model.login);case 2:s=t.sent,console.log("user",s),200===s.status?(sessionStorage.setItem("token",s.data.token),sessionStorage.setItem("user",JSON.stringify(s.data.user)),e.$store.commit("updateUser",s.data.user),e.$socket.disconnect(),e.$socket.connect(),e.$toast({type:"success",message:"登录成功"}),e.$router.push("/main")):e.$toast({type:"fail",message:"登录失败"});case 5:case"end":return t.stop()}}),t)})))()},register:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("/register",e.model.register);case 2:s=t.sent,e.$toast({type:"success",message:"注册成功"}),console.log(s),e.model.login.phone=s.data.phone,e.model.active=0;case 7:case"end":return t.stop()}}),t)})))()},validatorUsername:function(e){return/^.{1,8}$/.test(e)},validatorPhone:function(e){return/^1[3456789]\d{9}$/.test(e)},validatorPassword:function(e){return/^.{3,30}$/.test(e)},validatorPassword2:function(){return this.model.register.password===this.model.register.password2||(this.model.register.password="",this.model.register.password2="",!1)}}},X=Q,Z=(s("3738"),Object(o["a"])(X,V,G,!1,null,"a4106e6c",null)),ee=Z.exports,te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user"},[s("my-top-bar",{attrs:{"left-arrow":"","left-text":"个人信息"}}),s("van-cell-group",[s("van-uploader",{attrs:{"after-read":e.afterRead}},[s("van-cell",{staticClass:"d-flex ai-center",scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"fs-lg text-dark"},[e._v("头像")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-image",{attrs:{width:"1.4rem",height:"1.4rem",radius:".133333rem",src:e.$store.state.user.avatar,fit:"cover"}}),s("van-icon",{staticClass:"pl-1",attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell",{staticClass:"d-flex ai-center fs-lg pt-1-5 pb-1-5",attrs:{to:"/user/username"},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"fs-lg text-dark"},[e._v("昵称")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("span",{staticClass:"text-dark-3"},[e._v(e._s(e.$store.state.user.username))]),s("van-icon",{staticClass:"pl-1",attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])}),s("van-cell",{staticClass:"d-flex ai-center fs-lg pt-1-5 pb-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"fs-lg text-dark"},[e._v("通信号")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("span",{staticClass:"text-dark-3"},[e._v(e._s(e.$store.state.user.phone))]),s("van-icon",{staticClass:"pl-1",attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])}),s("van-cell",{staticClass:"d-flex ai-center fs-lg pt-1-5 pb-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"fs-lg text-dark"},[e._v("二维码名片")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{"class-prefix":"iconfont iconerweima",size:".373333rem",color:"#e8e8e8"}}),s("van-icon",{staticClass:"pl-1",attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])}),s("van-cell",{staticClass:"d-flex ai-center fs-lg pt-1-5 pb-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"fs-lg text-dark"},[e._v("更多")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{staticClass:"pl-1",attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell-group",{staticClass:"mt-1"},[s("van-cell",{staticClass:"d-flex ai-center fs-lg pt-1-5 pb-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"fs-lg text-dark"},[e._v("我的地址")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{staticClass:"pl-1",attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1)],1)},se=[],ae={data:function(){return{}},methods:{afterRead:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function s(){var a,n,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return a=e.file,n=new FormData,n.append("img",a),s.next=5,t.$http.post("/upload",n);case 5:r=s.sent,200===r.status?t.updateAvatar(r.data.url):t.$toast({type:"fail",message:"修改失败"});case 7:case"end":return s.stop()}}),s)})))()},updateAvatar:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,t.$http.put("/rest/users/".concat(t.$store.state.user._id),{avatar:e});case 2:t.$store.commit("updateAvatar",e),t.$toast({type:"success",message:"修改成功"});case 4:case"end":return s.stop()}}),s)})))()}}},ne=ae,re=(s("b9df"),Object(o["a"])(ne,te,se,!1,null,"74f7e87a",null)),oe=re.exports,ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"set_up-container"},[s("my-top-bar",{attrs:{"left-arrow":"","left-text":"设置"}}),s("div",{staticClass:"set_up-inner-container"},[s("van-cell-group",[s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg pt-1-5 pb-1-5",attrs:{to:"/set_up"},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark flex-grow-1"},[e._v("账号与安全")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell-group",[s("van-cell",{staticClass:"cell-container fs-lg pt-1-5 pb-1-5"},[s("div",{staticClass:"text-center"},[s("span",{staticClass:"cell-title fs-lg text-dark"},[e._v("切换账号")])])])],1),s("van-cell-group",[s("van-cell",{staticClass:"cell-container fs-lg pt-1-5 pb-1-5",on:{click:e.showPopup}},[s("div",{staticClass:"text-center"},[s("span",{staticClass:"cell-title fs-lg text-dark"},[e._v("退出")])])])],1)],1),s("van-popup",{staticClass:"popup",attrs:{round:"",position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("van-cell-group",[s("van-cell",{staticClass:"cell-container fs-lg pt-1-5 pb-1-5",on:{click:e.logout}},[s("div",{staticClass:"text-center"},[s("span",{staticClass:"cell-title fs-lg text-dark"},[e._v("退出登录")])])]),s("van-cell",{staticClass:"cell-container fs-lg pt-1-5 pb-1-5",on:{click:e.logout}},[s("div",{staticClass:"text-center"},[s("span",{staticClass:"cell-title fs-lg text-dark"},[e._v("关闭通信")])])])],1),s("van-cell-group",[s("van-cell",{staticClass:"cell-container fs-lg pt-1-5 pb-1-5",on:{click:e.cancelPopup}},[s("div",{staticClass:"text-center"},[s("span",{staticClass:"cell-title fs-lg text-dark"},[e._v("取消")])])])],1)],1)],1)},ce=[],le={data:function(){return{show:!1}},methods:{showPopup:function(){this.show=!0},cancelPopup:function(){this.show=!1},logout:function(){sessionStorage.removeItem("token"),sessionStorage.removeItem("user"),this.$store.dispatch("disconnectSocket"),this.$router.push("/login")}}},ue=le,de=(s("2418"),Object(o["a"])(ue,ie,ce,!1,null,"5aa6ab28",null)),fe=de.exports,pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"username"},[s("my-top-bar",{attrs:{"left-arrow":"","left-text":"更改名字"},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",{staticClass:"nav-bar_right"},[e.$store.state.user.username===e.username?s("van-button",{staticClass:"bt-color",attrs:{type:"primary",size:"small"}},[e._v("保存")]):s("van-button",{attrs:{type:"primary",size:"small"},on:{click:e.updateUsername}},[e._v("保存")])],1)]},proxy:!0}])}),s("div",{staticClass:"d-flex jc-center mt-1"},[s("van-field",{staticClass:"field",model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),s("p",{staticClass:"fs-sm text-dark-3 pl-1 ml-0-5"},[e._v("好的名字可以让朋友更容易记住你")])],1)},me=[],ve={data:function(){return{username:this.$store.state.user.username}},methods:{updateUsername:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.put("/rest/users/".concat(e.$store.state.user._id),{username:e.username});case 2:s=t.sent,200===s.status&&(e.$store.commit("updateUsername",e.username),e.$toast({type:"success",message:"修改成功"}));case 4:case"end":return t.stop()}}),t)})))()}},computed:{}},he=ve,ge=(s("2a56"),Object(o["a"])(he,pe,me,!1,null,"515d5c98",null)),xe=ge.exports,ye=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"new_friends"},[s("my-top-bar",{attrs:{"left-arrow":"","left-text":"新朋友"},scopedSlots:e._u([{key:"right",fn:function(){return[s("router-link",{attrs:{to:"/new_friends/add_friends",tag:"div"}},[s("span",[e._v("添加朋友")])])]},proxy:!0}])}),s("van-search",{staticClass:"search",attrs:{background:"#ededed",placeholder:"通信号/手机号","input-align":"center"},on:{focus:e.toSearchPage},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}}),s("div",{staticClass:"container"},e._l(e.newFriends,(function(t,a){return s("van-cell",{key:a,staticClass:"cell-container d-flex ai-center fs-lg",scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-image",{attrs:{width:"1.1112rem",height:"1.1112rem",radius:".133333rem",src:t.fromId.avatar}})]},proxy:!0},{key:"title",fn:function(){return[s("div",{staticClass:"d-flex"},[s("span",{staticClass:"cell-title pl-1 fs-lg text-dark flex-grow-1"},[e._v(e._s(t.fromId.username))])])]},proxy:!0},{key:"label",fn:function(){return[s("span",{staticClass:"cell-title fs-sm pl-1 text-dark-3"},[e._v(e._s(t.checkMessage))])]},proxy:!0},{key:"default",fn:function(){return[3===t.status?s("van-button",{attrs:{type:"primary",size:"small"},on:{click:function(s){return e.agreeToAddFriend(t)}}},[e._v("接受")]):e._e(),1===t.status?s("span",{staticClass:"pr-0-5"},[e._v("已添加")]):e._e()]},proxy:!0}],null,!0)})})),1)],1)},_e=[],be={sockets:{addFriend:function(e){this.newFriends=e.addFriendInformations}},created:function(){this.getNewFriends()},data:function(){return{phone:"",newFriends:[]}},methods:{toSearchPage:function(){this.$router.push({path:"/new_friends/search_friends"})},getNewFriends:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("/rest/users/add_friend_informations/".concat(e.$store.state.user._id));case 2:s=t.sent,e.newFriends=s.data.addFriendInformations;case 4:case"end":return t.stop()}}),t)})))()},agreeToAddFriend:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function s(){var a,n,r,o,i,c;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,t.$http.get("/rest/users/".concat(t.$store.state.user._id));case 2:return a=s.sent,n=a.data.friends,n.push(e.fromId._id),s.next=7,t.$http.put("/rest/users/".concat(t.$store.state.user._id),{friends:n});case 7:return s.next=9,t.$http.get("/rest/users/".concat(e.fromId._id));case 9:return r=s.sent,o=r.data.friends,o.push(t.$store.state.user._id),s.next=14,t.$http.put("/rest/users/".concat(e.fromId._id),{friends:o});case 14:return s.next=16,t.$http.put("/rest/add_friend_Informations/".concat(e._id),{status:1});case 16:return t.getNewFriends(),t.$store.dispatch("updateUser"),s.next=20,t.$http.post("/rest/sockets/conditions",{userId:e.fromId._id});case 20:i=s.sent,c=i.data[0].socketId,t.$socket.emit("updateFriends",c,{toId:e.fromId._id,fromId:t.$store.state.user._id,checkMessage:"我们现在是朋友了",username:t.$store.state.user.username});case 23:case"end":return s.stop()}}),s)})))()}}},we=be,ke=(s("a5ba"),Object(o["a"])(we,ye,_e,!1,null,"0be3fd66",null)),Ce=ke.exports,$e=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"add_friend"},[s("my-top-bar",{attrs:{"left-arrow":"","left-text":"添加朋友"}}),s("van-search",{staticClass:"search",attrs:{background:"#ededed",placeholder:"请输入通信号/手机号","input-align":"center"},on:{focus:e.toSearchPage},model:{value:e.model.phone,callback:function(t){e.$set(e.model,"phone",t)},expression:"model.phone"}}),s("div",{staticClass:"d-flex jc-center pt-1 pb-3"},[s("span",{staticClass:"fs-sm text-dark-3"},[e._v("我的通信号："+e._s(e.$store.state.user.phone))]),s("van-icon",{staticClass:"pl-1",attrs:{"class-prefix":"iconfont iconerweima",size:".373333rem",color:"#959595"}})],1)],1)},Se=[],je={data:function(){return{model:{phone:""}}},methods:{toSearchPage:function(){this.$router.push({path:"/new_friends/search_friends"})}}},Oe=je,Me=(s("138d"),Object(o["a"])(Oe,$e,Se,!1,null,"5efe2d46",null)),Ie=Me.exports,Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"search_friend"},[s("van-search",{ref:"searchId",staticClass:"search",attrs:{background:"#ededed",placeholder:"通信号/手机号","show-action":""},on:{cancel:e.Cancel,input:e.displaySearch},model:{value:e.model.phone,callback:function(t){e.$set(e.model,"phone",t)},expression:"model.phone"}}),s("van-divider",{style:{borderColor:"rgb(200, 200, 200)",margin:0}}),s("van-cell",{directives:[{name:"show",rawName:"v-show",value:e.model.isDisplay,expression:"model.isDisplay"}],staticClass:"d-flex ai-center",on:{click:function(t){return e.searchFriends(e.model.phone)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("div",{staticClass:"my-icon my-icon-1 d-flex jc-center ai-center"},[s("van-icon",{attrs:{"class-prefix":"iconfont iconbg-add-friend",size:".586667rem",color:"#fff"}})],1)]},proxy:!0},{key:"title",fn:function(){return[s("div",{staticClass:"cell-title pl-1 fs-lg text-dark d-flex ai-center"},[s("span",[e._v("搜索:")]),s("span",{staticClass:"text-green text-ellipsis my-text"},[e._v(e._s(e.model.phone))])])]},proxy:!0}])}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.model.isSearch,expression:"model.isSearch"}],staticClass:"d-flex jc-center py-3 bg-white"},[s("span",{staticClass:"fs-sm text-dark-3"},[e._v("该用户不存在")])])],1)},Pe=[],Ee={mounted:function(){this.$refs.searchId.children[0].children[0].children[1].children[0].children[0].focus()},data:function(){return{model:{phone:"",isSearch:!1,isDisplay:!1}}},methods:{Cancel:function(){this.$router.go(-1)},searchFriends:function(e){var t=this;return Object(g["a"])(regeneratorRuntime.mark((function s(){var a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.hideSearch(),s.next=3,t.$http.post("/rest/users/conditions",{phone:e});case 3:a=s.sent,0===a.data.length?t.model.isSearch=!0:(t.model.isSearch=!1,t.$router.push({path:"/user_profiles",query:a.data[0]}));case 5:case"end":return s.stop()}}),s)})))()},displaySearch:function(){this.model.isSearch=!1,""===this.model.phone?this.model.isDisplay=!1:this.model.isDisplay=!0},hideSearch:function(){this.model.isDisplay=!1}}},Re=Ee,ze=(s("c851"),Object(o["a"])(Re,Te,Pe,!1,null,"a3b48d4e",null)),Fe=ze.exports,Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"userProfile"},[s("my-top-bar",{attrs:{"left-arrow":""},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",[s("van-icon",{attrs:{name:"ellipsis"}})],1)]},proxy:!0}])}),s("van-cell-group",{},[s("van-cell",{staticClass:"cell-container d-flex jc-between fs-lg py-2",attrs:{to:""},scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-image",{attrs:{width:"1.555555rem",height:"1.555555rem",radius:".133333rem",src:e.friend.avatar,fit:"cover"}})]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-xxl text-dark flex-grow-1"},[e._v(e._s(e.friend.username))])]},proxy:!0},{key:"label",fn:function(){return[s("div",{staticClass:"d-flex flex-column"},[s("span",{staticClass:"cell-title fs-md pl-1 text-dark-3 flex-grow-1 pt-0-5"},[e._v("昵称："+e._s(e.friend.username))]),s("span",{staticClass:"cell-title fs-md pl-1 text-dark-3 flex-grow-1 pt-0-5"},[e._v("通信号："+e._s(e.friend.phone))])])]},proxy:!0}])}),s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg py-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"cell-title fs-lg text-dark flex-grow-1"},[e._v("设置备注和标签")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell-group",{staticClass:"mt-1"},[s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg py-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"d-flex"},[s("span",{staticClass:"fs-lg text-dark"},[e._v("个性签名")]),s("span",{staticClass:"pl-1 fs-lg text-dark-3 text-ellipsis sign"},[e._v(e._s(e.friend.signature))])])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell-group",{staticClass:"mt-1"},[s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg py-1-5",on:{click:e.toAddFriend}},[[s("div",{staticClass:"d-flex jc-center"},[s("span",{staticClass:"fs-lg text-blue-1"},[e._v("添加到通讯录")])])]],2)],1)],1)},Ue=[],qe={data:function(){return{friend:this.$route.query}},methods:{toAddFriend:function(){this.$router.push({path:"/apply_add_friends",query:this.friend})}}},Ne=qe,Be=(s("81ed"),Object(o["a"])(Ne,Ae,Ue,!1,null,"3b91db2e",null)),De=Be.exports,Je=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"applyAddFriend"},[s("my-top-bar",{attrs:{"left-arrow":""},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",[s("van-button",{attrs:{type:"primary",size:"small"},on:{click:e.addFriend}},[e._v("发送")])],1)]},proxy:!0}])}),s("div",{},[e._m(0),s("div",{staticClass:"d-flex jc-center"},[s("div",{staticClass:"message"},[s("span",{staticClass:"text-dark-3 fs-md"},[e._v("发送添加朋友申请信息")]),s("van-field",{ref:"my-field",staticClass:"mt-0-5 my-field",model:{value:e.checkMessage,callback:function(t){e.checkMessage=t},expression:"checkMessage"}})],1)])])],1)},We=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"d-flex jc-center"},[s("h4",[e._v("申请添加朋友")])])}],Le={data:function(){return{friend:this.$route.query,checkMessage:""}},methods:{addFriend:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("friend",e.friend),t.next=3,e.$http.post("/rest/sockets/conditions",{userId:e.friend._id});case 3:s=t.sent,console.log("socketMap",s),a=s.data[0].socketId,e.$socket.emit("addFriend",a,{toId:e.friend._id,fromId:e.$store.state.user._id,checkMessage:e.checkMessage}),e.$router.go(-1),e.$toast({type:"success",message:"请求成功"});case 9:case"end":return t.stop()}}),t)})))()}}},Ke=Le,Ye=(s("bf80"),Object(o["a"])(Ke,Je,We,!1,null,"9694f3d8",null)),He=Ye.exports,Ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"userProfile"},[s("my-top-bar",{attrs:{"left-arrow":""},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",[s("van-icon",{attrs:{name:"ellipsis"}})],1)]},proxy:!0}])}),s("van-cell-group",{},[s("van-cell",{staticClass:"cell-container d-flex jc-between fs-lg py-2",attrs:{to:""},scopedSlots:e._u([{key:"icon",fn:function(){return[s("van-image",{attrs:{width:"1.555555rem",height:"1.555555rem",radius:".133333rem",src:e.friend.avatar,fit:"cover"}})]},proxy:!0},{key:"title",fn:function(){return[s("span",{staticClass:"cell-title pl-1 fs-xxl text-dark flex-grow-1"},[e._v(e._s(e.friend.username))])]},proxy:!0},{key:"label",fn:function(){return[s("div",{staticClass:"d-flex flex-column"},[s("span",{staticClass:"cell-title fs-md pl-1 text-dark-3 flex-grow-1 pt-0-5"},[e._v("昵称："+e._s(e.friend.username))]),s("span",{staticClass:"cell-title fs-md pl-1 text-dark-3 flex-grow-1 pt-0-5"},[e._v("通信号："+e._s(e.friend.phone))])])]},proxy:!0}])}),s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg py-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"cell-title fs-lg text-dark flex-grow-1"},[e._v("设置备注和标签")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])}),s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg py-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("span",{staticClass:"cell-title fs-lg text-dark flex-grow-1"},[e._v("朋友圈权限")])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell-group",{staticClass:"mt-1"},[s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg py-1-5",attrs:{to:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"d-flex"},[s("span",{staticClass:"fs-lg text-dark"},[e._v("个性签名")]),s("span",{staticClass:"pl-1 fs-lg text-dark-3 text-ellipsis sign"},[e._v(e._s(e.friend.signature))])])]},proxy:!0},{key:"right-icon",fn:function(){return[s("van-icon",{attrs:{name:"arrow",color:"#e9e9e9"}})]},proxy:!0}])})],1),s("van-cell-group",{staticClass:"mt-1"},[s("van-cell",{staticClass:"cell-container d-flex ai-center jc-between fs-lg py-1-5",on:{click:e.toChat}},[[s("div",{staticClass:"d-flex jc-center ai-center"},[s("van-icon",{staticClass:"pr-1",attrs:{"class-prefix":"iconfont iconchat_bubble",size:".55rem",color:"#60739b"}}),s("span",{staticClass:"fs-lg text-blue-1"},[e._v("发消息")])],1)]],2)],1)],1)},Ge=[],Qe={data:function(){return{friend:this.$route.query}},methods:{toChat:function(){this.$router.push({path:"/address_book/chat",query:this.friend})}}},Xe=Qe,Ze=(s("734f"),Object(o["a"])(Xe,Ve,Ge,!1,null,"7543b75a",null)),et=Ze.exports,tt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat d-flex flex-column"},[s("my-top-bar",{attrs:{"left-arrow":"","left-text":e.friend.username,to:"/main/home"},scopedSlots:e._u([{key:"right",fn:function(){return[s("van-icon",{attrs:{name:"ellipsis"}})]},proxy:!0}])}),s("div",{ref:"chat",staticClass:"chat-container flex-grow-1"},e._l(e.privateMessage,(function(t,a){return s("div",{key:a},[t.fromId===e.friend._id?s("div",{staticClass:"left"},[s("div",{staticClass:"image"},[s("van-image",{attrs:{width:"1rem",height:"1rem",radius:".133333rem",src:e.friend.avatar}})],1),s("div",[s("p",[e._v(e._s(t.message))])])]):s("div",{staticClass:"right"},[s("div",[s("p",{staticClass:"right"},[e._v(e._s(t.message))])]),s("div",{staticClass:"image"},[s("van-image",{attrs:{width:"1rem",height:"1rem",radius:".133333rem",src:e.$store.state.user.avatar}})],1)])])})),0),s("div",{staticClass:"chat-bottom"},[s("div",{staticClass:"d-flex ai-center py-0-5 px-0-5"},[s("van-icon",{attrs:{"class-prefix":"iconfont iconyuyin voice pr-0-5",size:"0.6rem",color:"#000"}}),s("van-field",{attrs:{maxlength:"50"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),s("van-icon",{attrs:{"class-prefix":"iconfont icondaxiao pl-0-5 pr-0-5",size:"0.6rem",color:"#000"}}),s("van-icon",{directives:[{name:"show",rawName:"v-show",value:!e.message,expression:"!message"}],attrs:{"class-prefix":"iconfont icontianjia2",size:"0.6rem",color:"#000"}}),s("van-button",{directives:[{name:"show",rawName:"v-show",value:e.message,expression:"message"}],attrs:{type:"primary",size:"small"},on:{click:e.sendMessage}},[e._v("发送")])],1)])],1)},st=[],at={mounted:function(){this.scrollToBottom()},sockets:{privateChat:function(e){console.log("chatSocket",e)}},data:function(){return{friend:this.$route.query,message:""}},methods:{sendMessage:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s={},s.message=e.message,s.fromId=e.$store.state.user._id,s.toId=e.friend._id,s.createTime=new Date,e.$store.commit("privateChatSelf",s),console.log("message",s),t.next=9,e.$http.post("/rest/sockets/conditions",{userId:e.friend._id});case 9:a=t.sent,console.log("res",a),e.$socket.emit("privateChat",a.data[0].socketId,s),e.message="";try{e.scrollToBottom()}catch(n){console.log("scrollToBottomErr",n)}case 14:case"end":return t.stop()}}),t)})))()},scrollToBottom:function(){var e=this;this.$nextTick((function(){var t=e.$refs.chat;document.documentElement.scrollTop=t.scrollHeight}))},scrollToTop:function(e){var t=window.scrollY/2,s=0,a=performance.now();function n(r){s+=Math.PI/(e/(r-a)),s>=Math.PI&&window.scrollTo(0,0),0!==window.scrollY&&(window.scrollTo(0,Math.round(t+t*Math.cos(s))),a=r,window.requestAnimationFrame(n))}window.requestAnimationFrame(n)}},computed:{privateMessage:function(){return this.scrollToBottom(),this.$store.state.chatMessage[this.friend._id]}}},nt=at,rt=(s("67d9"),Object(o["a"])(nt,tt,st,!1,null,"f850f9b6",null)),ot=rt.exports,it=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat d-flex flex-column"},[s("my-top-bar",{attrs:{"left-arrow":"","left-text":"世界"},scopedSlots:e._u([{key:"right",fn:function(){return[s("div",{on:{click:e.leaveWorldRoom}},[e.isConnect?s("div",{staticClass:"d-flex ai-center"},[s("van-button",{attrs:{type:"primary",size:"small"}},[e._v("拒收")]),s("span",{staticClass:"iconfont iconConnect fs-xxl ml-1"})],1):s("div",{staticClass:"d-flex ai-center"},[s("van-button",{attrs:{type:"primary",size:"small"}},[e._v("接收")]),s("span",{staticClass:"iconfont iconDisconnect fs-xxl ml-1"})],1)])]},proxy:!0}])}),s("div",{ref:"chat",staticClass:"chat-container flex-grow-1"},e._l(e.worldMessage,(function(t,a){return s("div",{key:a},[t.fromId!==e.userId?s("div",{staticClass:"left"},[s("div",{staticClass:"image"},[s("van-image",{attrs:{width:"1rem",height:"1rem",radius:".133333rem",src:t.avatar}})],1),s("div",[s("span",{staticClass:"fs-sm text-dark-3 va-text-top"},[e._v(e._s(t.username))]),s("p",[e._v(e._s(t.message))])])]):s("div",{staticClass:"right"},[s("div",[s("p",{staticClass:"right"},[e._v(e._s(t.message))])]),s("div",{staticClass:"image"},[s("van-image",{attrs:{width:"1rem",height:"1rem",radius:".133333rem",src:t.avatar}})],1)])])})),0),s("div",{staticClass:"chat-bottom"},[s("div",{staticClass:"d-flex ai-center py-0-5 px-0-5"},[s("van-icon",{attrs:{"class-prefix":"iconfont iconyuyin voice pr-0-5",size:"0.6rem",color:"#000"}}),s("van-field",{attrs:{maxlength:"50"},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),s("van-icon",{attrs:{"class-prefix":"iconfont icondaxiao pl-0-5 pr-0-5",size:"0.6rem",color:"#000"}}),s("van-icon",{directives:[{name:"show",rawName:"v-show",value:!e.message,expression:"!message"}],attrs:{"class-prefix":"iconfont icontianjia2",size:"0.6rem",color:"#000"}}),s("van-button",{directives:[{name:"show",rawName:"v-show",value:e.message,expression:"message"}],attrs:{type:"primary",size:"small"},on:{click:e.sendMessage}},[e._v("发送")])],1)])],1)},ct=[],lt={created:function(){this.joinWorldRoom()},mounted:function(){this.scrollToBottom()},sockets:{worldChat:function(e){console.log("worldChat",e)}},data:function(){return{userId:this.$store.state.user._id,worldFriend:{id:"world"},message:"",isConnect:!0}},methods:{sendMessage:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:s={},s.message=e.message,s.fromId=e.$store.state.user._id,s.username=e.$store.state.user.username,s.avatar=e.$store.state.user.avatar,s.toId=e.worldFriend.id,s.room=e.worldFriend.id,s.createTime=new Date,e.$store.commit("updateWorldMessageSendBySelf",s),e.$socket.emit("worldMessage",s),e.message="";try{e.scrollToBottom()}catch(a){console.log("scrollToBottomErr",a)}case 12:case"end":return t.stop()}}),t)})))()},scrollToBottom:function(){var e=this;this.$nextTick((function(){var t=e.$refs.chat;document.documentElement.scrollTop=t.scrollHeight}))},scrollToTop:function(e){var t=window.scrollY/2,s=0,a=performance.now();function n(r){s+=Math.PI/(e/(r-a)),s>=Math.PI&&window.scrollTo(0,0),0!==window.scrollY&&(window.scrollTo(0,Math.round(t+t*Math.cos(s))),a=r,window.requestAnimationFrame(n))}window.requestAnimationFrame(n)},joinWorldRoom:function(){this.$socket.emit("join",{room:this.worldFriend.id})},leaveWorldRoom:function(){this.isConnect?(this.$socket.emit("leave",{room:this.worldFriend.id}),this.isConnect=!1):(this.joinWorldRoom(),this.isConnect=!0)}},computed:{worldMessage:function(){return this.scrollToBottom(),this.$store.state.worldMessage}}},ut=lt,dt=(s("908f"),Object(o["a"])(ut,it,ct,!1,null,"14485f36",null)),ft=dt.exports;a["a"].use(u["a"]);var pt=[{path:"/",redirect:"/login"},{path:"/login",component:ee,meta:{isPublic:!0}},{path:"/main",name:"Main",redirect:"/main/home",component:h,children:[{path:"home",component:I},{path:"address_book",component:F},{path:"find",component:D},{path:"my",component:H}]},{path:"/user",component:oe},{path:"/user/username",component:xe},{path:"/set_up",component:fe},{path:"/new_friends",component:Ce},{path:"/new_friends/add_friends",component:Ie},{path:"/new_friends/search_friends",component:Fe},{path:"/user_profiles",component:De},{path:"/apply_add_friends",component:He},{path:"/address_book/friend",component:et},{path:"/address_book/chat",component:ot},{path:"/main/find/world",component:ft}],mt=new u["a"]({routes:pt});mt.beforeEach((function(e,t,s){var n=sessionStorage.token,r=JSON.parse(sessionStorage.user||"{}");if(!e.meta.isPublic&&!n)return a["a"].prototype.$toast({type:"fail",message:"请先登录"}),s({path:"/login"});0===Object.keys(C.state.user).length&&0!==Object.keys(r).length&&C.commit("updateUser",r),s()}));var vt=mt,ht=(s("9a83"),s("f564")),gt=(s("5852"),s("d961")),xt=(s("e930"),s("8f80")),yt=(s("2b28"),s("9ed2")),_t=(s("38d5"),s("772a")),bt=(s("e7e5"),s("d399")),wt=(s("bda7"),s("5e46")),kt=(s("da3c"),s("0b33")),Ct=(s("be7f"),s("565f")),$t=(s("8a58"),s("e41f")),St=(s("5246"),s("6b41")),jt=(s("0653"),s("34e9")),Ot=(s("4056"),s("44bf")),Mt=(s("0cc8"),s("3104")),It=(s("66b9"),s("b650")),Tt=(s("c194"),s("7744")),Pt=(s("a52c"),s("2ed4")),Et=(s("6894"),s("e11d")),Rt=(s("615f"),s("92e2")),zt=(s("537a"),s("ac28")),Ft=(s("c3a6"),s("ad06"));a["a"].use(Ft["a"]),a["a"].use(zt["a"]),a["a"].use(Rt["a"]),a["a"].use(Et["a"]),a["a"].use(Pt["a"]),a["a"].use(Tt["a"]),a["a"].use(It["a"]),a["a"].use(Mt["a"]),a["a"].use(Ot["a"]),a["a"].use(jt["a"]),a["a"].use(St["a"]),a["a"].use($t["a"]),a["a"].use(Ct["a"]),a["a"].use(kt["a"]),a["a"].use(wt["a"]),a["a"].use(bt["a"]),a["a"].use(_t["a"]),a["a"].use(yt["a"]),a["a"].use(xt["a"]),a["a"].use(gt["a"]),a["a"].use(ht["a"]);s("5cfb"),s("be35"),s("78a7"),s("d3b7");var At=s("bc3a"),Ut=s.n(At),qt=Ut.a.create({baseURL:Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_API_URL||"/web/api"});qt.interceptors.request.use((function(e){var t=sessionStorage.token;return t&&(e.headers.Authorization="Bearer "+t),e}),(function(e){return Promise.reject(e)})),qt.interceptors.response.use((function(e){return e}),(function(e){return e.response.data.message&&a["a"].prototype.$toast({type:"fail",message:e.response.data.message}),401===e.response.status&&vt.push("/login"),Promise.reject(e)}));var Nt=qt,Bt=s("5132"),Dt=s.n(Bt),Jt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("van-sticky",[s("div",{staticClass:"topbar bg-gray fs-xl d-flex jc-between p-1 ai-center"},[e._t("left",[s("div",{staticClass:"nav-bar_left"},[e.leftArrow&&!e.to?s("i",{staticClass:"va-middle icon-arrow-left iconfont icon-left-arrow fs-xxxl",on:{click:e.back}}):e._e(),e.leftArrow&&e.to?s("router-link",{staticClass:"va-middle icon-arrow-left iconfont icon-left-arrow fs-xxxl",attrs:{to:e.to,tag:"i"}}):e._e(),s("span",{staticClass:"pl-1"},[e._v(e._s(e.leftText?e.leftText:""))])],1)]),e._t("default"),e._t("right")],2)])],1)},Wt=[],Lt={props:{"left-text":{type:String},"left-arrow":{type:Boolean,default:!1},to:{type:String,default:""}},data:function(){return{}},methods:{back:function(){this.$router.go(-1)}}},Kt=Lt,Yt=(s("d139"),Object(o["a"])(Kt,Jt,Wt,!1,null,"d0301436",null)),Ht=Yt.exports,Vt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("van-cell",[s("div",{staticClass:"cell-container d-flex ai-center"},[s("van-image",{attrs:{width:"1rem",height:"1rem",radius:".133333rem",src:e.src}}),s("span",{staticClass:"cell-title pl-1 fs-lg text-dark"},[e._v(e._s(e.title))])],1)])},Gt=[],Qt={props:{src:{type:String,required:!0},title:{type:String,required:!0}}},Xt=Qt,Zt=Object(o["a"])(Xt,Vt,Gt,!1,null,null,null),es=Zt.exports;a["a"].prototype.$http=Nt,a["a"].component("my-top-bar",Ht),a["a"].component("my-cell",es),a["a"].config.productionTip=!1,a["a"].use(new Dt.a({debug:!0,connection:"http://chat.jishitongxin.top/chat",vuex:{store:C,actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"}})),new a["a"]({router:vt,store:C,render:function(e){return e(l)}}).$mount("#app")},"67d9":function(e,t,s){"use strict";var a=s("fd48"),n=s.n(a);n.a},"67eb":function(e,t,s){},"734f":function(e,t,s){"use strict";var a=s("107b"),n=s.n(a);n.a},7448:function(e,t,s){},"78a7":function(e,t,s){},7911:function(e,t,s){},"81ed":function(e,t,s){"use strict";var a=s("d025"),n=s.n(a);n.a},"908f":function(e,t,s){"use strict";var a=s("9c3a"),n=s.n(a);n.a},"966a":function(e,t,s){},"9c3a":function(e,t,s){},a5ba:function(e,t,s){"use strict";var a=s("ef5a"),n=s.n(a);n.a},a8ca:function(e,t,s){},a9a5:function(e,t,s){},b7d3:function(e,t,s){"use strict";var a=s("7448"),n=s.n(a);n.a},b9df:function(e,t,s){"use strict";var a=s("a9a5"),n=s.n(a);n.a},be35:function(e,t,s){},bf80:function(e,t,s){"use strict";var a=s("a8ca"),n=s.n(a);n.a},c851:function(e,t,s){"use strict";var a=s("67eb"),n=s.n(a);n.a},d025:function(e,t,s){},d139:function(e,t,s){"use strict";var a=s("d902"),n=s.n(a);n.a},d902:function(e,t,s){},dc12:function(e,t,s){"use strict";var a=s("e1e3"),n=s.n(a);n.a},e1e3:function(e,t,s){},ebba:function(e,t,s){},ef5a:function(e,t,s){},f8fa:function(e,t,s){},fd48:function(e,t,s){}});
//# sourceMappingURL=app.cb99fdb8.js.map